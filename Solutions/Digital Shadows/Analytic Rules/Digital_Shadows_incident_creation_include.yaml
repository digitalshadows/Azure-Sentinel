
id: f7abe9c1-1e6c-4317-b907-25769e7764c5
name: Digital Shadows incident creation rule app 1
kind: Scheduled
properties:
  displayName: Digital Shadows Incident rule - App 1
  description: ''
  severity: Medium
  enabled: true
  query: "let DSSearchLight_view  = view () { \n    DigitalShadows_CL\n    | where
    app_s == \"include\"\n    | extend \n                EventVendor=\"Digital Shadows\",\n
    \               EventProduct=\"SearchLight\",\n                Type=\"DigitalShadows_CL\",\n
    \               EventStartTime=raised_t,\n                EventMessage=title_s,\n
    \               EventOriginalUid=triage_id_g,\n                EventOriginalType=classification_s\n
    \   | extend EventOriginalSeverity=iif(isempty(risk_level_s), risk_assessment_risk_level_s,
    risk_level_s)\n    | extend EventSeverity = case(EventOriginalSeverity == 'none',
    'Informational',\n                                EventOriginalSeverity == 'very-low',
    'Low',\n                                EventOriginalSeverity == 'low', 'Low',\n
    \                               EventOriginalSeverity == 'medium', 'Medium',\n
    \                               EventOriginalSeverity == 'high', 'High',\n                                EventOriginalSeverity
    == 'very-high', 'High',\n                                'Informational')\n
    \   | extend EventReportUrl=iif(isempty(id_d), strcat('https://portal-digitalshadows.com/triage/alerts/',portal_id_s),
    strcat('https://portal-digitalshadows.com/triage/alert-incidents/',id_d))\n
    \   | extend AdditionalFields = pack(\"assets\", assets_s,\n                           \"comments\",
    comments_s,\n                           \"description\", description_s,\n                           \"incident_id\",
    id_d,\n                           \"alert_id\", id_g,\n                           \"short_code\",
    portal_id_s,\n                           \"impact\", impact_description_s,\n
    \                          \"mitigation\", mitigation_s,\n                           \"risk_factors\",
    risk_factors_s,\n                           \"triage_status\", status_s,\n                           \"triage_id\",
    triage_id_g,\n                           \"triage_raised\", triage_raised_time_t,\n
    \                          \"triage_updated\", triage_updated_time_t,\n                           \"updated\",
    updated_t)\n    | project\n                TimeGenerated,\n                EventVendor,\n
    \               EventProduct,\n                Type,\n                EventStartTime,\n
    \               EventMessage,\n                EventOriginalUid,\n                EventOriginalType,\n
    \               EventOriginalSeverity,\n                EventSeverity,\n                EventReportUrl,\n
    \               AdditionalFields\n};\n\nDSSearchLight_view\n| summarize arg_max(TimeGenerated,
    *) by EventOriginalUid | extend description = AdditionalFields.description|
    extend impact = AdditionalFields.impact| extend mitigation = AdditionalFields.mitigation|
    extend status = AdditionalFields.triage_status| extend comments = AdditionalFields.comments"
  queryFrequency: PT5M
  queryPeriod: PT6M
  triggerOperator: GreaterThan
  triggerThreshold: 0
  suppressionDuration: PT5H
  suppressionEnabled: false
  tactics: []
  techniques: []
  alertRuleTemplateName:
  incidentConfiguration:
    createIncident: true
    groupingConfiguration:
      enabled: true
      reopenClosedIncident: false
      lookbackDuration: P7D
      matchingMethod: Selected
      groupByEntities: []
      groupByAlertDetails: []
      groupByCustomDetails:
      - triage_id
  eventGroupingSettings:
    aggregationKind: AlertPerResult
  alertDetailsOverride:
    alertDisplayNameFormat: Digital Shadows - {{EventMessage}}
    alertDescriptionFormat: |-
      {{description}}

      {{impact}}

      {{mitigation}}
    alertTacticsColumnName:
    alertSeverityColumnName: EventSeverity
  customDetails:
    triage_id: EventOriginalUid
    severity: EventOriginalSeverity
    description: description
    status: status
    comments: comments
    impact: impact
    mitigation: mitigation
  entityMappings: null